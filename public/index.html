<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Level Validator Dashboard</title>
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Inter", sans-serif;
        background: #f8f9fc;
        line-height: 1.5;
        color: #333;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      .header {
        background: linear-gradient(90deg, #667eea, #764ba2);
        padding: 40px 20px;
        text-align: center;
        color: #fff;
        border-radius: 0 0 20px 20px;
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        margin-bottom: 40px;
      }

      .header h1 {
        font-size: 2.5rem;
        font-weight: 700;
        margin-bottom: 10px;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.95;
      }

      .dashboard-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
      }

      .card {
        background: #fff;
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        transition: transform 0.25s ease, box-shadow 0.25s ease;
      }

      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 12px 25px rgba(0, 0, 0, 0.12);
      }

      .card h2 {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 20px;
        color: #2d3748;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #4a5568;
      }

      .form-group input,
      .form-group select {
        width: 100%;
        padding: 12px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }

      .form-group input:focus,
      .form-group select:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      }

      .btn {
        background: linear-gradient(90deg, #667eea, #764ba2);
        color: #fff;
        border: none;
        padding: 12px 24px;
        border-radius: 10px;
        font-weight: 500;
        font-size: 1rem;
        cursor: pointer;
        transition: background 0.3s ease, transform 0.15s ease;
      }

      .btn:hover {
        background: linear-gradient(90deg, #5a6dde, #6e48a6);
        transform: translateY(-2px);
      }

      .btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .results-section {
        grid-column: 1 / -1;
      }

      .result-card {
        background: white;
        border-radius: 16px;
        padding: 30px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
      }

      .confidence-score {
        display: inline-block;
        padding: 8px 16px;
        border-radius: 20px;
        font-weight: 600;
        margin-bottom: 20px;
      }

      .confidence-high {
        background: #c6f6d5;
        color: #22543d;
      }

      .confidence-medium {
        background: #fef5e7;
        color: #744210;
      }

      .confidence-low {
        background: #fed7d7;
        color: #742a2a;
      }

      .feedback-section {
        margin-top: 20px;
      }

      .feedback-item {
        background: #f7fafc;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 10px;
        border-left: 4px solid #667eea;
      }

      .suggestions {
        margin-top: 15px;
      }

      .suggestion-item {
        background: #edf2f7;
        padding: 10px 15px;
        border-radius: 6px;
        margin-bottom: 8px;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .loading {
        display: none;
        text-align: center;
        padding: 40px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #667eea;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      }

      .stat-number {
        font-size: 2rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 5px;
      }

      .stat-label {
        color: #718096;
        font-size: 0.9rem;
      }

      .history-section {
        grid-column: 1 / -1;
      }

      .history-item {
        background: white;
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #667eea;
      }

      .history-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
      }

      .history-level {
        font-weight: 600;
        color: #2d3748;
      }

      .history-time {
        color: #718096;
        font-size: 0.9rem;
      }

      .error-message {
        background: #fed7d7;
        color: #742a2a;
        padding: 15px;
        border-radius: 8px;
        margin-top: 20px;
        border-left: 4px solid #e53e3e;
      }

      @media (max-width: 768px) {
        .dashboard-grid {
          grid-template-columns: 1fr;
        }

        .container {
          padding: 15px;
        }

        .header h1 {
          font-size: 2rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="header">
        <h1><i class="fas fa-gamepad"></i> Level Validator Dashboard</h1>
        <p>
          Validate and optimize your game level configurations with AI-powered
          analysis
        </p>
      </div>

      <div class="stats-grid">
        <div class="stat-card">
          <div
            class="stat-number"
            id="totalValidations"
          >
            0
          </div>
          <div class="stat-label">Total Validations</div>
        </div>
        <div class="stat-card">
          <div
            class="stat-number"
            id="avgConfidence"
          >
            0.0
          </div>
          <div class="stat-label">Avg Confidence</div>
        </div>
        <div class="stat-card">
          <div
            class="stat-number"
            id="successRate"
          >
            0%
          </div>
          <div class="stat-label">Success Rate</div>
        </div>
        <div class="stat-card">
          <div
            class="stat-number"
            id="modelsUsed"
          >
            0
          </div>
          <div class="stat-label">Models Used</div>
        </div>
      </div>

      <div class="dashboard-grid">
        <div class="card">
          <h2><i class="fas fa-cogs"></i> Level Configuration</h2>
          <form id="validationForm">
            <div class="form-group">
              <label for="level">Level Number</label>
              <input
                type="number"
                id="level"
                name="level"
                min="1"
                max="100"
                required
              />
            </div>

            <div class="form-group">
              <label for="difficulty">Difficulty</label>
              <select
                id="difficulty"
                name="difficulty"
                required
              >
                <option value="">Select difficulty</option>
                <option value="easy">Easy</option>
                <option value="medium">Medium</option>
                <option value="hard">Hard</option>
              </select>
            </div>

            <div class="form-group">
              <label for="reward">Reward Points</label>
              <input
                type="number"
                id="reward"
                name="reward"
                min="0"
                required
              />
            </div>

            <div class="form-group">
              <label for="time_limit">Time Limit (seconds)</label>
              <input
                type="number"
                id="time_limit"
                name="time_limit"
                min="1"
                required
              />
            </div>

            <div class="form-group">
              <label for="model">AI Model</label>
              <select
                id="model"
                name="model"
                required
              >
                <option value="">Select model</option>
                <option value="gpt-4-turbo">GPT-4 Turbo</option>
                <option value="gpt-4">GPT-4</option>
                <option value="gpt-4o-mini">GPT-4o Mini</option>
              </select>
            </div>

            <button
              type="submit"
              class="btn"
              id="validateBtn"
            >
              <i class="fas fa-check-circle"></i>
              Validate Level
            </button>
          </form>
        </div>

        <div class="card">
          <h2><i class="fas fa-chart-line"></i> Quick Stats</h2>
          <div id="quickStats">
            <div class="stat-card">
              <div class="stat-number">Easy: <span id="easyCount">0</span></div>
              <div class="stat-label">Easy Levels</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">
                Medium: <span id="mediumCount">0</span>
              </div>
              <div class="stat-label">Medium Levels</div>
            </div>
            <div class="stat-card">
              <div class="stat-number">Hard: <span id="hardCount">0</span></div>
              <div class="stat-label">Hard Levels</div>
            </div>
          </div>
        </div>
      </div>

      <div
        class="loading"
        id="loading"
      >
        <div class="spinner"></div>
        <p>Analyzing your level configuration...</p>
      </div>

      <div
        class="results-section"
        id="resultsSection"
        style="display: none"
      >
        <div class="result-card">
          <h2><i class="fas fa-clipboard-check"></i> Validation Results</h2>
          <div id="validationResults"></div>
        </div>
      </div>

      <div
        class="history-section"
        id="historySection"
      >
        <div class="card">
          <h2><i class="fas fa-history"></i> Validation History</h2>
          <div id="validationHistory">
            <p style="text-align: center; color: #718096; padding: 40px">
              No validations yet. Submit a level configuration to see history.
            </p>
          </div>
        </div>
      </div>
    </div>

    <script>
      class LevelValidatorDashboard {
        constructor() {
          this.validations = JSON.parse(
            localStorage.getItem("validationHistory") || "[]"
          );
          this.init();
        }

        init() {
          this.bindEvents();
          this.updateStats();
          this.renderHistory();
        }

        bindEvents() {
          const form = document.getElementById("validationForm");
          form.addEventListener("submit", (e) => this.handleSubmit(e));
        }

        async handleSubmit(e) {
          e.preventDefault();

          const formData = new FormData(e.target);
          const config = {
            level: parseInt(formData.get("level")),
            difficulty: formData.get("difficulty"),
            reward: parseInt(formData.get("reward")),
            time_limit: parseInt(formData.get("time_limit")),
            model: formData.get("model"),
          };

          this.showLoading(true);

          try {
            const response = await fetch("/validate", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(config),
            });

            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();
            this.handleValidationResult(result, config);
          } catch (error) {
            this.handleError(error);
          } finally {
            this.showLoading(false);
          }
        }

        handleValidationResult(result, config) {
          // Store validation in history
          const validation = {
            id: Date.now(),
            timestamp: new Date().toISOString(),
            config,
            result,
          };

          this.validations.unshift(validation);
          localStorage.setItem(
            "validationHistory",
            JSON.stringify(this.validations)
          );

          // Update UI
          this.displayResult(result);
          this.updateStats();
          this.renderHistory();

          // Show results section
          document.getElementById("resultsSection").style.display = "block";
          document
            .getElementById("resultsSection")
            .scrollIntoView({ behavior: "smooth" });
        }

        displayResult(result) {
          const resultsDiv = document.getElementById("validationResults");

          let confidenceClass = "confidence-low";
          if (result.confidence_score >= 0.8)
            confidenceClass = "confidence-high";
          else if (result.confidence_score >= 0.5)
            confidenceClass = "confidence-medium";

          resultsDiv.innerHTML = `
                    <div class="confidence-score ${confidenceClass}">
                        <i class="fas fa-star"></i>
                        Confidence Score: ${result.confidence_score}
                    </div>
                    
                    <div class="feedback-section">
                        <h3><i class="fas fa-robot"></i> AI Analysis</h3>
                        <div class="feedback-item">
                            <strong>Model Used:</strong> ${result.model_used}
                        </div>
                        <div class="feedback-item">
                            <strong>Analysis:</strong> ${
                              result.llm_feedback.analysis
                            }
                        </div>
                        
                        ${
                          result.llm_feedback.suggested_actions.length > 0
                            ? `
                            <div class="suggestions">
                                <h4><i class="fas fa-lightbulb"></i> Suggested Actions:</h4>
                                ${result.llm_feedback.suggested_actions
                                  .map(
                                    (action) =>
                                      `<div class="suggestion-item">
                                        <i class="fas fa-arrow-right"></i>
                                        ${action}
                                    </div>`
                                  )
                                  .join("")}
                            </div>
                        `
                            : ""
                        }
                    </div>
                `;
        }

        handleError(error) {
          const resultsDiv = document.getElementById("validationResults");
          resultsDiv.innerHTML = `
                    <div class="error-message">
                        <i class="fas fa-exclamation-triangle"></i>
                        <strong>Error:</strong> ${error.message}
                    </div>
                `;
          document.getElementById("resultsSection").style.display = "block";
        }

        showLoading(show) {
          document.getElementById("loading").style.display = show
            ? "block"
            : "none";
          document.getElementById("validateBtn").disabled = show;
        }

        updateStats() {
          if (this.validations.length === 0) return;

          const total = this.validations.length;
          const avgConfidence =
            this.validations.reduce(
              (sum, v) => sum + v.result.confidence_score,
              0
            ) / total;
          const successCount = this.validations.filter(
            (v) => v.result.confidence_score >= 0.8
          ).length;
          const successRate = (successCount / total) * 100;
          const modelsUsed = new Set(
            this.validations.map((v) => v.result.model_used)
          ).size;

          // Difficulty counts
          const difficultyCounts = this.validations.reduce((acc, v) => {
            acc[v.config.difficulty] = (acc[v.config.difficulty] || 0) + 1;
            return acc;
          }, {});

          document.getElementById("totalValidations").textContent = total;
          document.getElementById("avgConfidence").textContent =
            avgConfidence.toFixed(2);
          document.getElementById(
            "successRate"
          ).textContent = `${successRate.toFixed(0)}%`;
          document.getElementById("modelsUsed").textContent = modelsUsed;

          document.getElementById("easyCount").textContent =
            difficultyCounts.easy || 0;
          document.getElementById("mediumCount").textContent =
            difficultyCounts.medium || 0;
          document.getElementById("hardCount").textContent =
            difficultyCounts.hard || 0;
        }

        renderHistory() {
          const historyDiv = document.getElementById("validationHistory");

          if (this.validations.length === 0) {
            historyDiv.innerHTML = `
                        <p style="text-align: center; color: #718096; padding: 40px;">
                            No validations yet. Submit a level configuration to see history.
                        </p>
                    `;
            return;
          }

          historyDiv.innerHTML = this.validations
            .slice(0, 10)
            .map((validation) => {
              const date = new Date(validation.timestamp);
              let confidenceClass = "confidence-low";
              if (validation.result.confidence_score >= 0.8)
                confidenceClass = "confidence-high";
              else if (validation.result.confidence_score >= 0.5)
                confidenceClass = "confidence-medium";

              return `
                        <div class="history-item">
                            <div class="history-header">
                                <span class="history-level">
                                    Level ${validation.config.level} (${
                validation.config.difficulty
              })
                                </span>
                                <span class="history-time">
                                    ${date.toLocaleDateString()} ${date.toLocaleTimeString()}
                                </span>
                            </div>
                            <div class="confidence-score ${confidenceClass}" style="display: inline-block; margin: 0;">
                                Confidence: ${
                                  validation.result.confidence_score
                                }
                            </div>
                            <p style="margin-top: 10px; color: #718096;">
                                Reward: ${validation.config.reward} | Time: ${
                validation.config.time_limit
              }s | Model: ${validation.result.model_used}
                            </p>
                        </div>
                    `;
            })
            .join("");
        }
      }

      // Initialize dashboard when page loads
      document.addEventListener("DOMContentLoaded", () => {
        new LevelValidatorDashboard();
      });
    </script>
  </body>
</html>
